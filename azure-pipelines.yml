trigger:
- '*'

pool:
  vmImage: 'ubuntu-16.04'

container : grahamschock/composite_dev_env:latest

steps:
  - script: |
      curl https://sh.rustup.rs -sSf | sh -s -- -y
      echo "##vso[task.setvariable variable=PATH;]$PATH:$HOME/.cargo/bin"
    displayName: Install rust
  - script: | 
      rustup default nightly
      cargo install xargo
      rustup component add rust-src 
    displayName: Add Rust Composite Dependencies
  - script: |
      ./cos init
    displayName: Initialize Composite
  - script: |
      ./cos build
    displayName: Build Composite
  - script: | 
      ./cos compose composition_scripts/sched.toml test
    displayName: Compile Sched Test
  - script: |
      timeout --preserve-status 10 ./cos run system_binaries/cos_build test/cos.img > sched_tests.txt
      exit 0
    displayName: Run Sched Tests
  - script : |
      cat sched_tests.txt
    displayName: Display Sched Tests